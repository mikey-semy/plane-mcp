# Архитектура Plane MCP Server

```
┌─────────────────────────────────────────────────────────────────┐
│                         MCP Clients                              │
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │Claude Desktop│  │   VS Code    │  │  Custom App  │          │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘          │
│         │                  │                  │                   │
│         └──────────────────┴──────────────────┘                   │
│                            │                                       │
└────────────────────────────┼───────────────────────────────────────┘
                             │
                    ┌────────▼────────┐
                    │   SSE / stdio   │
                    │    Transport    │
                    └────────┬────────┘
                             │
┌────────────────────────────┼───────────────────────────────────────┐
│                  Plane MCP Server (Python)                         │
│                                                                     │
│  ┌─────────────────────────▼───────────────────────────┐          │
│  │              FastMCP Framework                       │          │
│  │  - Auto schema generation from docstrings           │          │
│  │  - Type validation via Pydantic                      │          │
│  │  - HTTP/SSE server on :8000                          │          │
│  └─────────────────────┬───────────────────────────────┘          │
│                        │                                            │
│  ┌────────────────────┴────────────────────┐                      │
│  │           Tool Registry (47)             │                      │
│  │                                          │                      │
│  │  ┌────────────┐  ┌──────────────┐      │                      │
│  │  │User (2)    │  │Metadata (15) │      │                      │
│  │  │- current   │  │- issue_types │      │                      │
│  │  │- members   │  │- states      │      │                      │
│  │  └────────────┘  │- labels      │      │                      │
│  │                  └──────────────┘      │                      │
│  │  ┌────────────┐  ┌──────────────┐      │                      │
│  │  │Projects(2) │  │Issues (8)    │      │                      │
│  │  │- list      │  │- CRUD        │      │                      │
│  │  │- create    │  │- comments    │      │                      │
│  │  └────────────┘  │- readable_id │      │                      │
│  │                  └──────────────┘      │                      │
│  │  ┌────────────┐  ┌──────────────┐      │                      │
│  │  │Modules(5)  │  │Module Iss(3) │      │                      │
│  │  │- CRUD      │  │- list/add/rm │      │                      │
│  │  └────────────┘  └──────────────┘      │                      │
│  │                                          │                      │
│  │  ┌────────────┐  ┌──────────────┐      │                      │
│  │  │Cycles (6)  │  │Cycle Iss (3) │      │                      │
│  │  │- CRUD      │  │- list/add/rm │      │                      │
│  │  │- transfer  │  └──────────────┘      │                      │
│  │  └────────────┘                         │                      │
│  │                                          │                      │
│  │  ┌────────────┐                         │                      │
│  │  │Worklogs(5) │                         │                      │
│  │  │- CRUD      │                         │                      │
│  │  │- total     │                         │                      │
│  │  └────────────┘                         │                      │
│  └─────────────────────┬────────────────────┘                      │
│                        │                                            │
│  ┌────────────────────▼────────────────────┐                      │
│  │       Request Helper (httpx)             │                      │
│  │  - Async HTTP client                     │                      │
│  │  - Error handling (PlaneAPIError)        │                      │
│  │  - Authentication (API Key)              │                      │
│  │  - JSON serialization                    │                      │
│  └─────────────────────┬────────────────────┘                      │
│                        │                                            │
└────────────────────────┼───────────────────────────────────────────┘
                         │
                         │ HTTPS
                         │
                ┌────────▼────────┐
                │   Plane API     │
                │ app.plane.so    │
                └─────────────────┘


┌─────────────────────────────────────────────────────────────────┐
│                    Data Flow Example                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│  1. Client Request: create_issue(project_id, name, ...)         │
│           │                                                       │
│           ▼                                                       │
│  2. FastMCP validates input via Pydantic schemas                │
│           │                                                       │
│           ▼                                                       │
│  3. Tool function in issues.py called                            │
│           │                                                       │
│           ▼                                                       │
│  4. make_plane_request() prepares HTTP request                   │
│           │                                                       │
│           ▼                                                       │
│  5. httpx sends POST to Plane API                                │
│           │                                                       │
│           ▼                                                       │
│  6. Response validated & returned as JSON                        │
│           │                                                       │
│           ▼                                                       │
│  7. Client receives formatted issue data                         │
│                                                                   │
└─────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────┐
│                    Deployment Options                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│  Option 1: Local Development                                     │
│  ┌──────────────────────────────┐                               │
│  │  uv run python -m plane_mcp  │                               │
│  │  Runs on localhost:8000      │                               │
│  └──────────────────────────────┘                               │
│                                                                   │
│  Option 2: Docker Container                                      │
│  ┌──────────────────────────────┐                               │
│  │  docker-compose up           │                               │
│  │  Isolated environment        │                               │
│  │  Health checks enabled       │                               │
│  └──────────────────────────────┘                               │
│                                                                   │
│  Option 3: Claude Desktop Integration                            │
│  ┌──────────────────────────────┐                               │
│  │  stdio transport             │                               │
│  │  Direct process spawning     │                               │
│  │  Config in claude_desktop    │                               │
│  └──────────────────────────────┘                               │
│                                                                   │
└─────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────┐
│                    Technology Stack                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌───────────────┐    ┌───────────────┐   ┌──────────────┐    │
│  │ Python 3.12   │────│ FastMCP 1.21  │───│ httpx 0.28   │    │
│  │ Runtime       │    │ MCP Framework │   │ HTTP Client  │    │
│  └───────────────┘    └───────────────┘   └──────────────┘    │
│                                                                   │
│  ┌───────────────┐    ┌───────────────┐   ┌──────────────┐    │
│  │ Pydantic 2.x  │────│ python-dotenv │───│ uv manager   │    │
│  │ Validation    │    │ Environment   │   │ Dependencies │    │
│  └───────────────┘    └───────────────┘   └──────────────┘    │
│                                                                   │
│  ┌───────────────┐    ┌───────────────┐                        │
│  │ Docker        │────│ docker-compose│                        │
│  │ Container     │    │ Orchestration │                        │
│  └───────────────┘    └───────────────┘                        │
│                                                                   │
└─────────────────────────────────────────────────────────────────┘
```

## Ключевые особенности архитектуры

### 1. Модульная структура
- Каждая категория инструментов в отдельном файле
- Единый request_helper для всех HTTP запросов
- Централизованные Pydantic схемы

### 2. Асинхронность
- Все I/O операции асинхронные
- Нет блокировок при работе с API
- Поддержка множественных одновременных запросов

### 3. Типобезопасность
- Pydantic валидация входных/выходных данных
- Type hints во всех функциях
- Автоматическая генерация схем MCP

### 4. Обработка ошибок
- PlaneAPIError для API ошибок
- HTTP status code валидация
- Понятные сообщения об ошибках

### 5. Гибкость развёртывания
- SSE transport для удалённого доступа
- stdio transport для локальной интеграции
- Docker для изолированной среды
