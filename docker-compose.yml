services:
  plane-mcp:
    build: .
    container_name: plane-mcp-server
    ports:
      - "${HOST_PORT:-8000}:${MCP_PORT:-8000}"
    environment:
      - PLANE_API_KEY=${PLANE_API_KEY}
      - PLANE_WORKSPACE_SLUG=${PLANE_WORKSPACE_SLUG}
      - PLANE_API_HOST_URL=${PLANE_API_HOST_URL:-https://api.plane.so/}
      - MCP_TRANSPORT=sse
      - MCP_HOST=0.0.0.0
      - MCP_PORT=${MCP_PORT:-8000}
      # Basic Auth credentials
      - BASIC_AUTH_USER=${BASIC_AUTH_USER:-admin}
      - BASIC_AUTH_PASSWORD=${BASIC_AUTH_PASSWORD:-SecurePassword123}
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.middlewares.mcp-auth.basicauth.users=${BASIC_AUTH_USER}:${BASIC_AUTH_PASSWORD_HASH}"
      - "traefik.http.routers.mcp.middlewares=mcp-auth"
      - "traefik.http.routers.mcp.rule=PathPrefix(`/`)"
      - "traefik.http.services.mcp.loadbalancer.server.port=${MCP_PORT:-8000}"
    # Healthcheck disabled - FastMCP SSE endpoint may not respond to curl
    # healthcheck:
    #   test: ["CMD", "curl", "-f", "http://localhost:${MCP_PORT:-8000}/sse"]
    #   interval: 60s
    #   timeout: 10s
    #   retries: 5
    #   start_period: 60s
